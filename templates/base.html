<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mi Sitio Web{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div id="dynamic-page-background"></div> <!-- Nuevo contenedor para el fondo dinámico -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="https://www.twitch.tv/aupachus" target="_blank" rel="noopener noreferrer" aria-label="Ir al perfil de Twitch">Aupachus</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'home' %}active{% endif %}"
                           href="{{ url_for('home') }}"
                           {% if current_endpoint == 'home' %}aria-current="page"{% endif %}>Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'galeria' %}active{% endif %}"
                           href="{{ url_for('galeria') }}"
                           {% if current_endpoint == 'galeria' %}aria-current="page"{% endif %}>Galería de fotos</a>
                
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'ver_pdfs' %}active{% endif %}"
                           href="{{ url_for('ver_pdfs') }}"
                           {% if current_endpoint == 'ver_pdfs' %}aria-current="page"{% endif %}>Aprende</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'social' %}active{% endif %}"
                           href="{{ url_for('social') }}"
                           {% if current_endpoint == 'social' %}aria-current="page"{% endif %}>Lanzadera</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'enlaces' %}active{% endif %}"
                           href="{{ url_for('enlaces') }}"
                           {% if current_endpoint == 'enlaces' %}aria-current="page"{% endif %}>Enlaces</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'cursos' %}active{% endif %}"
                           href="{{ url_for('cursos') }}"
                           {% if current_endpoint == 'cursos' %}aria-current="page"{% endif %}>Cursos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'opinion' %}active{% endif %}"
                           href="{{ url_for('opinion') }}" 
                           {% if current_endpoint == 'opinion' %}aria-current="page"{% endif %}>¿Y tú qué opinas?</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://basquesource.blogspot.com/2025/05/basque-source-first-commit.html" target="_blank" rel="noopener noreferrer">BLOGGER</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://discord.gg/VtA2mXkRBT" target="_blank" rel="noopener noreferrer">DISCORD</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenido principal -->
    <div class="container mt-4">
        {% block content %}
        {% endblock %}
    </div>

    <!-- Bootstrap JS (Bundle incluye Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Datos para JavaScript -->
    <script>
        const APP_TRACKS = [
            {%- for track in music_tracks -%}
                "{{ url_for('static', filename=(audio_folder_name + '/' + track.filename)) }}"{%- if not loop.last -%},{%- endif -%}
            {%- endfor -%}
        ];
        // URLs completas para las imágenes de fondo/galería
        const APP_BACKGROUND_IMAGE_URLS = [
            {%- for image_filename in background_images -%}
                "{{ url_for('static', filename=(gallery_img_folder_for_url + '/' + image_filename)) }}"{%- if not loop.last -%},{%- endif -%}
            {%- endfor -%}
        ];
    </script>
    <!-- Scripts personalizados -->
    <script src="{{ url_for('static', filename='js/dynamicBackground.js') }}"></script> <!-- Nuevo script para fondo -->
    <script src="{{ url_for('static', filename='js/player.js') }}"></script>
    
    <!-- Script global para la animación de texto y animación de la barra de navegación -->
    <script>
        function animateTextFlyOut(text, targetElement) {
            if (!targetElement || typeof text !== 'string') return;

            const elementRect = targetElement.getBoundingClientRect();
            const container = document.body;
            const computedStyle = window.getComputedStyle(targetElement);
            const baseColor = computedStyle.color;
            const baseFontFamily = computedStyle.fontFamily;
            const baseFontSize = computedStyle.fontSize;

            // Si el elemento no es visible o no tiene dimensiones, no animar
            if (elementRect.width === 0 && elementRect.height === 0 && text.length > 0) {
                // console.warn("Target element for animation is not visible or has no dimensions:", targetElement);
                return;
            }

            const startX = elementRect.left + elementRect.width / 2;
            const startY = elementRect.top + elementRect.height / 2;

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (char.trim() === '') continue;

                const span = document.createElement('span');
                span.textContent = char;
                span.style.position = 'fixed';
                span.style.left = `${startX}px`;
                span.style.top = `${startY}px`;
                span.style.transform = 'translate(-50%, -50%)'; // Centrar el span en su origen
                span.style.color = baseColor;
                span.style.fontFamily = baseFontFamily;
                span.style.fontSize = baseFontSize;
                span.style.pointerEvents = 'none';
                span.style.zIndex = '10001'; // Asegurar que esté por encima de otros elementos
                span.style.willChange = 'transform, opacity'; // Optimización para el navegador
                container.appendChild(span);

                const flyDuration = (1800 + Math.random() * 1200); // Duración entre 1.8s y 3s
                const angle = Math.random() * Math.PI * 2;
                // Distancia de recorrido (similar a la que te gustó, bastante amplia)
                const distance = Math.min(window.innerWidth, window.innerHeight) * (0.8 + Math.random() * 1.2);
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;
                const rotation = (Math.random() - 0.5) * 720; // Rotación aleatoria

                span.animate([
                    { transform: `translate(-50%, -50%) translate(0px, 0px) rotate(0deg)`, opacity: 1 },
                    { transform: `translate(-50%, -50%) translate(${endX}px, ${endY}px) rotate(${rotation}deg)`, opacity: 0 }
                ], {
                    duration: flyDuration,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)', // Suavizado para efecto natural
                    fill: 'forwards' // Mantiene el estado final de la animación
                }).onfinish = () => {
                    if (span.parentNode) { // Comprobar si el span aún existe antes de removerlo
                        span.remove();
                    }
                };
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const navBarLinks = document.querySelectorAll('.navbar-nav .nav-link');
            if (navBarLinks.length > 0) {
                navBarLinks.forEach((link, index) => {
                    const originalLinkText = link.textContent.trim();
                    if (originalLinkText !== '' && !link.classList.contains('dropdown-toggle') && !link.querySelector('img') && !link.querySelector('i')) {
                        const baseIntervalTime = 15000 + (Math.random() * 10000); // Intervalo largo (15-25s)
                        setTimeout(() => {
                            setInterval(function() {
                                if (document.body.contains(link) && getComputedStyle(link).display !== 'none') {
                                    animateTextFlyOut(originalLinkText, link);
                                }
                            }, baseIntervalTime);
                        }, index * 1200 + Math.random() * 800); // Inicio escalonado
                    }
                });
            }

            // Efecto de explosión de letras al pasar el ratón sobre elementos de texto elegibles
            const hoverAnimatedElementsCooldown = new Set(); // Para el enfriamiento

            document.body.addEventListener('mouseover', function(event) {
                let target = event.target;

                // Si el objetivo directo es un nodo de texto, usar su elemento padre
                if (target.nodeType === Node.TEXT_NODE) {
                    target = target.parentElement;
                }

                // Asegurarse de que el objetivo es un HTMLElement
                if (!(target instanceof HTMLElement)) {
                    return;
                }

                // Selectores para elementos elegibles (ajusta según sea necesario)
                const eligibleSelectors = [
                    'p',
                    'h1:not(.animated-title)', // Excluir títulos principales con animación propia
                    'h2:not(.animated-title)',
                    'h3:not(.animated-title)',
                    'h4', 'h5', 'h6',
                    'li',
                    'span:not(.navbar-toggler-icon)', // Spans generales, excluyendo iconos de Bootstrap
                    'a', // Hacer elegibles los enlaces genéricos
                    'td', 'th', // Celdas de tablas
                    'label:not([for="trackSelector"]):not([for="volumeControl"])',
                    // Añadir elementos comunes de formato en línea
                    'strong', 'em', 'b', 'i', 'u', 'small', 'mark'
                ].join(',');

                // Selectores para elementos a excluir explícitamente
                const exclusionSelectors = [
                    '.navbar-nav .nav-link', // Ya tienen animación temporizada
                    'a[href^="mailto:"]',    // Ya tiene animación temporizada
                    'h1.animated-title',     // Ya tiene animación temporizada
                    'div.text-center:last-of-type > a.btn', // Botones de sección en index.html
                    '.navbar-brand', // Excluir el brand de la navbar
                    '#translatable-welcome-text p', // El bloque de bienvenida tiene animación de caída
                    '#githubDropdown', '.dropdown-item', // Menú desplegable de GitHub
                    '#prevButton', '#playButton', '#nextButton', '#stopButton', // Botones del reproductor
                    '#trackSelector', '#volumeControl', // Controles del reproductor
                    'button[data-lang]', // Botones de traducción
                    '.learning-btn', // Excluir botones de aprendizaje de index.html
                    '.learning-btn-pdf', // Excluir botones de aprendizaje de pdfs.html
                    '.btn', // Excluir botones genéricos para evitar conflictos (algunos ya están cubiertos)
                    'script', 'style', 'textarea', 'input', 'select', 'option', 'button' // Elementos no textuales o interactivos
                ].join(',');

                if (target.matches(eligibleSelectors) && !target.closest(exclusionSelectors)) {
                    const textToAnimate = target.textContent;
                    if (textToAnimate && textToAnimate.trim() !== '') {
                        if (!hoverAnimatedElementsCooldown.has(target)) {
                            const style = window.getComputedStyle(target);
                            if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
                                return; // No animar elementos no visibles
                            }

                            animateTextFlyOut(textToAnimate, target);
                            hoverAnimatedElementsCooldown.add(target);

                            setTimeout(() => {
                                hoverAnimatedElementsCooldown.delete(target);
                            }, 3500); // Tiempo de enfriamiento (un poco más que la duración máx. de la animación)
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
