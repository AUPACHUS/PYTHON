<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Mi Sitio Web{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div id="background-container"></div>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="https://www.twitch.tv/aupachus" target="_blank" rel="noopener noreferrer" aria-label="Ir al perfil de Twitch">Aupachus</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'home' %}active{% endif %}"
                           href="{{ url_for('home') }}"
                           {% if current_endpoint == 'home' %}aria-current="page"{% endif %}>Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'galeria' %}active{% endif %}"
                           href="{{ url_for('galeria') }}"
                           {% if current_endpoint == 'galeria' %}aria-current="page"{% endif %}>Galería de fotos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'inteligencia_artificial' %}active{% endif %}"
                           href="{{ url_for('inteligencia_artificial') }}"
                           {% if current_endpoint == 'inteligencia_artificial' %}aria-current="page"{% endif %}>Lanzadera IA</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'ver_pdfs' %}active{% endif %}"
                           href="{{ url_for('ver_pdfs') }}"
                           {% if current_endpoint == 'ver_pdfs' %}aria-current="page"{% endif %}>PDF SOURCE</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'social' %}active{% endif %}"
                           href="{{ url_for('social') }}"
                           {% if current_endpoint == 'social' %}aria-current="page"{% endif %}>Redes Sociales</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'enlaces' %}active{% endif %}"
                           href="{{ url_for('enlaces') }}"
                           {% if current_endpoint == 'enlaces' %}aria-current="page"{% endif %}>Enlaces</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'cursos' %}active{% endif %}"
                           href="{{ url_for('cursos') }}"
                           {% if current_endpoint == 'cursos' %}aria-current="page"{% endif %}>Cursos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if current_endpoint == 'opinion' %}active{% endif %}"
                           href="{{ url_for('opinion') }}" 
                           {% if current_endpoint == 'opinion' %}aria-current="page"{% endif %}>¿Y tú qué opinas?</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://basquesource.blogspot.com/2025/05/basque-source-first-commit.html" target="_blank" rel="noopener noreferrer">BLOGGER</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="https://discord.gg/VtA2mXkRBT" target="_blank" rel="noopener noreferrer">DISCORD</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenido principal -->
    <div class="container mt-4">
        {% block content %}
        {% endblock %}
    </div>

    <!-- Bootstrap JS (Bundle incluye Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Datos para JavaScript -->
    <script>
        const APP_TRACKS = [
            {% for track in music_tracks %}
                "{{ url_for('static', filename='audio/' + track.filename) }}"{% if not loop.last %},{% endif %}
            {% endfor %}
        ];
        const APP_BACKGROUND_IMAGES = [
            {% for image_filename in background_images %}
                "{{ url_for('static', filename=background_img_folder_name + '/' + image_filename) }}"{% if not loop.last %},{% endif %}
            {% endfor %}
        ];
    </script>
    <!-- Scripts personalizados -->
    <script src="{{ url_for('static', filename='js/background.js') }}"></script>
    <script src="{{ url_for('static', filename='js/player.js') }}"></script>

    <!-- Script global para la animación de texto y animación de la barra de navegación -->
    <script>
        function animateTextFlyOut(text, targetElement) {
            if (!targetElement || typeof text !== 'string') return;

            const elementRect = targetElement.getBoundingClientRect();
            const container = document.body;
            const computedStyle = window.getComputedStyle(targetElement);
            const baseColor = computedStyle.color;
            const baseFontFamily = computedStyle.fontFamily;
            const baseFontSize = computedStyle.fontSize;

            // Si el elemento no es visible o no tiene dimensiones, no animar
            if (elementRect.width === 0 && elementRect.height === 0 && text.length > 0) {
                // console.warn("Target element for animation is not visible or has no dimensions:", targetElement);
                return;
            }

            const startX = elementRect.left + elementRect.width / 2;
            const startY = elementRect.top + elementRect.height / 2;

            for (let i = 0; i < text.length; i++) {
                const char = text[i];
                if (char.trim() === '') continue;

                const span = document.createElement('span');
                span.textContent = char;
                span.style.position = 'fixed';
                span.style.left = `${startX}px`;
                span.style.top = `${startY}px`;
                span.style.transform = 'translate(-50%, -50%)'; // Centrar el span en su origen
                span.style.color = baseColor;
                span.style.fontFamily = baseFontFamily;
                span.style.fontSize = baseFontSize;
                span.style.pointerEvents = 'none';
                span.style.zIndex = '10001'; // Asegurar que esté por encima de otros elementos
                span.style.willChange = 'transform, opacity'; // Optimización para el navegador
                container.appendChild(span);

                const flyDuration = (1800 + Math.random() * 1200); // Duración entre 1.8s y 3s
                const angle = Math.random() * Math.PI * 2;
                // Distancia de recorrido (similar a la que te gustó, bastante amplia)
                const distance = Math.min(window.innerWidth, window.innerHeight) * (0.8 + Math.random() * 1.2);
                const endX = Math.cos(angle) * distance;
                const endY = Math.sin(angle) * distance;
                const rotation = (Math.random() - 0.5) * 720; // Rotación aleatoria

                span.animate([
                    { transform: `translate(-50%, -50%) translate(0px, 0px) rotate(0deg)`, opacity: 1 },
                    { transform: `translate(-50%, -50%) translate(${endX}px, ${endY}px) rotate(${rotation}deg)`, opacity: 0 }
                ], {
                    duration: flyDuration,
                    easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)', // Suavizado para efecto natural
                    fill: 'forwards' // Mantiene el estado final de la animación
                }).onfinish = () => {
                    if (span.parentNode) { // Comprobar si el span aún existe antes de removerlo
                        span.remove();
                    }
                };
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            const navBarLinks = document.querySelectorAll('.navbar-nav .nav-link');
            if (navBarLinks.length > 0) {
                navBarLinks.forEach((link, index) => {
                    const originalLinkText = link.textContent.trim();
                    if (originalLinkText !== '' && !link.classList.contains('dropdown-toggle') && !link.querySelector('img') && !link.querySelector('i')) {
                        const baseIntervalTime = 15000 + (Math.random() * 10000); // Intervalo largo (15-25s)
                        setTimeout(() => {
                            setInterval(function() {
                                if (document.body.contains(link) && getComputedStyle(link).display !== 'none') {
                                    animateTextFlyOut(originalLinkText, link);
                                }
                            }, baseIntervalTime);
                        }, index * 1200 + Math.random() * 800); // Inicio escalonado
                    }
                });
            }
        });
    </script>
</body>
</html>
